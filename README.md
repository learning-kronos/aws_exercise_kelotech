# AWS総合演習

6月のチーム開発演習で作成したWebアプリケーション（KeloTech Store）をAWSにデプロイしてください。
RDSなど、一部のサービスはチーム内で共有するものの、各自でデプロイをしていきます。
チーム内で相談、協力しながら進めてください。

<br>

## 演習

### 演習1

以下の手順でWebアプリケーションをデプロイします。

- EC2インスタンスを立て、Webサーバー、アプリケーションサーバー、DBサーバーを構築し、Webアプリケーションをデプロイする。
- デプロイ後、Webアプリケーションが正常に動作することを確認する。

> Linux上のMySQLは大文字小文字を区別します。それによってCRUDが正常に動作しない場合は、一旦無視して継続してください。

- EC2インスタンスを停止 → 開始してWebアプリケーションにアクセスできることを確認してください。

<br>

EC2インスタンスの仕様は以下のとおりとします。

<table>
    <tr>
        <th>インスタンス名</th>
        <td>任意（チーム内で適切なインスタンス名を検討し統一する）<br>※先頭または末尾に自身の番号は含めること</td>
    </tr>
    <tr>
        <th>AMI</th>
        <td>Amazon Linux 2023 AMI</td>
    </tr>
    <tr>
        <th>インスタンスタイプ</th>
        <td>t2.micro</td>
    </tr>
    <tr>
        <th>キーペア</th>
        <td>ED25519で新規作成</td>
    </tr>
    <tr>
        <th>VPC</th>
        <td>自チームのVPC</td>
    </tr>
    <tr>
        <th>サブネット</th>
        <td>ap-northeast-1<b>a</b> （パブリック）</td>
    </tr>
    <tr>
        <th>セキュリティグループ</th>
        <td>新規作成<br>※適切なポート、ソースを設定する</td>
    </tr>
    <tr>
        <th>ストレージ</th>
        <td>30～50GiB</td>
    </tr>
</table>

<br>

### 演習2

以下の手順でDBサーバーをRDSに移管します。なお、各チームに1つのRDSをプライベートサブネットに作成しています。

- RDSアクセス用の踏み台サーバーを作成する。

<table>
    <tr>
        <th>インスタンス名</th>
        <td>jump-server<br>※先頭または末尾に自身の番号は含めること</td>
    </tr>
    <tr>
        <th>AMI</th>
        <td>Amazon Linux 2023 AMI</td>
    </tr>
    <tr>
        <th>インスタンスタイプ</th>
        <td>t2.micro</td>
    </tr>
    <tr>
        <th>キーペア</th>
        <td>演習1で作成したもの</td>
    </tr>
    <tr>
        <th>サブネット</th>
        <td>ap-northeast-1<b>a</b> （パブリック）</td>
    </tr>
    <tr>
        <th>セキュリティグループ</th>
        <td>
            <table>
                <tr>
                    <th colspan="2">インバウンドルール</th>
                </tr>
                <tr>
                    <th>ポート範囲</th>
                    <th>　ソース　</th>
                </tr>
                <tr>
                    <td>22（SSH）</td>
                    <td>マイID</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <th>ストレージ</th>
        <td>1 x 8GiB（gp3）</td>
    </tr>
</table>

- 踏み台サーバーにMySQLをインストールし、踏み台サーバー経由でRDSにログインする。RDS内にデータベースを作成し、Webアプリケーションに必要なテーブル、初期データを作成する。なお、データベースは各自のものを作成する。
- 踏み台サーバーのインスタンスを停止する。

<br>

### 演習3

WebアプリケーションのDB接続先をRDSに変更し、EC2インスタンスにデプロイし直してください。再デプロイ後、データ更新などの操作をし、RDS上のデータが更新されることを確認してください。その後、演習1で立てたEC2インスタンスからDBサーバー（MySQL）をアンインストールしてください。

<br>

### 演習4


EC2インスタンスに対してElastic IPを割り当ててIPアドレスを固定してください。EC2インスタンスを停止 → 開始してもIPアドレスが変わらず、Webアプリケーションにアクセスできることを確認してしましょう。確認後、Elastic IPの割り当てを解除してください。

<br>

### 演習5

EC2インスタンスのAMI（マイAMI）を作成してください。AMIの仕様は以下のとおりとします。

<table>
    <tr>
        <th>イメージ名</th>
        <td>任意<br>※先頭または末尾に自身の番号は含めること</td>
    </tr>
    <tr>
        <th>イメージの説明</th>
        <td>任意の説明</td>
    </tr>
    <tr>
        <th>ボリューム</th>
        <td>AMI元のEC2インスタンスのボリュームサイズ</td>
    </tr>
</table>

<br>

作成したAMIをもとに以下の仕様でEC2インスタンスを起動し、同様のWebアプリケーションにアクセスできることを確認してください。また、他方のEC2インスタンス上のWebアプリケーションで登録したデータが参照できることを確認してください。

<table>
    <tr>
        <th>インスタンス名</th>
        <td>任意（チーム内で適切なインスタンス名を検討し統一する）<br>※先頭または末尾に自身の番号は含めること</td>
    </tr>
    <tr>
        <th>AMI</th>
        <td>作成したAMI</td>
    </tr>
    <tr>
        <th>インスタンスタイプ</th>
        <td>t2.micro</td>
    </tr>
    <tr>
        <th>キーペア</th>
        <td>演習1で作成したもの</td>
    </tr>
    <tr>
        <th>VPC</th>
        <td>自チームのVPC</td>
    </tr>
    <tr>
        <th>サブネット</th>
        <td>ap-northeast-1<b>c</b> （パブリック）</td>
    </tr>
    <tr>
        <th>セキュリティグループ</th>
        <td>演習1で作成したもの</td>
    </tr>
    <tr>
        <th>ストレージ</th>
        <td>デフォルト</td>
    </tr>
</table>

<br>

### 演習6

ロードバランサー（ALB）を作成し、2つのEC2インスタンスに負荷分散する構成を構築してください。構築後、正常にWebアプリケーションへアクセスできること、データを更新しても整合性が保たれることを確認しましょう。また、以下の要件を満たすようにしてください。

- 各EC2インスタンスに直接アクセスできないようにする。
- セッションが維持できるようにする。

<br>

### 演習7

Webアプリケーションで使用しているロゴなどの画像をS3のバケットに格納し、Webアプリケーションの各ページはS3上の画像を参照するように修正してください。Webアプリケーションの各ページの画像が正常に表示されること、S3上の画像を上書きアップロードすると各ページに反映されることを確認しましょう。

修正後、EC2インスタンスにデプロイし直して、同じく正常に表示されることを確認してください。

<br>

### 演習8

プライバシーポリシーページ（HTML）をS3上に公開し、Webアプリケーションから参照するようにしてください。同ページのレイアウトおよび同ページへ遷移するリンクの配置場所に関しては、チームメンバーおよび講師と相談しましょう。

修正後、EC2インスタンスにデプロイし直して、同じく正常に表示されることを確認してください。

<br>

### 演習9

今月の売上商品数、売上金額をカテゴリごとに集計し、カテゴリIDの昇順で集計テーブルに登録する処理を追加してください。当該処理はAWS Lambdaを使用し、定期的に実行されるようにしてください。仕様修正する際は、チームメンバーや講師と相談しながら進めてください。

> 当該処理は本来月末の実行を想定していますが、開発中はその限りではありません。

<br>

### 演習10

ここまでのAWSのアーキテクチャをDraw.ioを使って図示してください。

Draw.io：https://app.diagrams.net/